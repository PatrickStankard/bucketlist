!function(a){"use strict";a.Bucketlist=function(b){var c,d,e,f,g,h,i,j,k,l;for(c=this,d=[b,a.bucketlistConfig],e=["url","limit"],i=0,k=d.length;k>i;i++)if("undefined"!=typeof d[i])for(j=0,l=e.length;l>j;j++)"undefined"!=typeof d[i][e[j]]&&(c[e[j]]=d[i][e[j]]);if(c.nameIcon={file:"glyphicon-file",directory:"glyphicon-folder-close"},c.nameLabel={file:"label-success",directory:"label-warning"},f={"ap-northeast-1":"s3-ap-northeast-1.amazonaws.com","ap-southeast-1":"s3-ap-southeast-1.amazonaws.com","ap-southeast-2":"s3-ap-southeast-2.amazonaws.com","eu-west-1":"s3-eu-west-1.amazonaws.com","us-east-1":"s3.amazonaws.com","us-west-1":"s3-us-west-1.amazonaws.com","us-west-2":"s3-us-west-2.amazonaws.com","sa-east-1":"s3-sa-east-1.amazonaws.com"},"undefined"==typeof c.url&&(c.url=a.location.host),c.url=c.url.toLowerCase().replace(/^\b.*?\b:/,"").replace(/^\/{1,}/,"").replace(/\/{1,}$/,"").trim(),-1!==c.url.indexOf(".s3-website-"))c.url=c.url.split(".s3-website-"),g=c.url[0].replace(/^\/{1,}/,"").trim(),h=c.url[1].split(".amazonaws.com")[0].replace(/^\/{1,}/,"").replace(/\/{1,}$/,"").trim(),c.url=f[h]+"/"+g;else for(var m in f)if(c.url===f[m]){g=c.url.split("/")[1].replace(/^\/{1,}/,"").replace(/\/{1,}$/,"").trim(),c.url=c.url+"/"+g;break}c.url="//"+c.url,c.url=$("<a></a>").attr("href",c.url)[0],c.url="//"+c.url.hostname+c.url.pathname,c.url=c.url.replace(/\/{1,}$/,"").trim(),"number"==typeof c.limit&&(c.limit=parseInt(c.limit,10)),(isNaN(c.limit)||c.limit<=0)&&(c.limit=100),c.delimiter="/",c.title=document.title.trim(),""===c.title&&(c.title="Bucketlist"),$(function(){c.$title=$("#bucketlist-title"),c.$container=$("#bucketlist-container"),c.$breadcrumb=$("#bucketlist-breadcrumb"),c.$tableBase=$("#bucketlist-table-base"),c.$tableContainer=$("#bucketlist-table-container"),c.$pagerContainer=$("#bucketlist-pager-container"),c.$loaderContainer=$("#bucketlist-loader-container"),c.$errorContainer=$("#bucketlist-error-container"),c.$errorHeading=$("#bucketlist-error-heading"),c.$errorRetry=$("#bucketlist-error-retry"),c.assignTableSelector(),c.$title.text(c.title),c.$pagerContainer.on("click","LI:not(.disabled) > A",function(){var a=$(this).parent().attr("class");"undefined"!=typeof a&&c.navigatePaginator({action:a})}),$(a).on("hashchange",function(){c.init()}),c.init()})},a.Bucketlist.prototype.init=function(){this.resetPage(),this.resetMarker(),this.navigate()},a.Bucketlist.prototype.resetPage=function(){this.page=0},a.Bucketlist.prototype.resetMarker=function(){this.marker={current:"",index:[""]}},a.Bucketlist.prototype.assignTableSelector=function(){this.$table=$("#bucketlist-table-container > TABLE.bucketlist-table:first")},a.Bucketlist.prototype.showContainer=function(a){a.removeClass("hidden")},a.Bucketlist.prototype.hideContainer=function(a){a.addClass("hidden")},a.Bucketlist.prototype.navigate=function(){var b,c,d;b=this,c=a.location.hash.replace(/^#!\//,"").trim(),c=decodeURIComponent(c),d={prefix:c,delimiter:b.delimiter,marker:b.marker.current,"max-keys":b.limit},b.fetchList(d)},a.Bucketlist.prototype.fetchList=function(a){var b=this;b.hideContainer(b.$container),b.hideContainer(b.$errorContainer),b.showContainer(b.$loaderContainer),b.$table.empty().remove(),b.$tableContainer.empty().html(b.$tableBase.html()).find("TABLE:first").addClass("bucketlist-table"),b.assignTableSelector(),$.ajax({url:b.url,dataType:"xml",data:a,success:function(c){b.parseReturn({xml:c,prefix:a.prefix})},error:function(c){b.ajaxErrorHandler({error:c,retry:a})}})},a.Bucketlist.prototype.ajaxErrorHandler=function(a){var b,c;b=this,c="","undefined"!=typeof a.error&&("undefined"!=typeof a.error.status&&0!==a.error.status&&(c=a.error.status+": "),"undefined"!=typeof a.error.statusText&&"error"!==a.error.statusText&&(c+=a.error.statusText)),""===c&&(c="Error"),b.$errorHeading.empty().text(c),b.$errorRetry.one("click",function(){b.fetchList(a.retry)}),b.hideContainer(b.$container),b.hideContainer(b.$loaderContainer),b.showContainer(b.$errorContainer)},a.Bucketlist.prototype.parseReturn=function(a){var b,c,d,e;b=this,c={},d=$(a.xml),e="",c.files=$.map(d.find("Contents"),function(a){return a=$(a),{name:a.find("Key:first").text(),lastModified:a.find("LastModified:first").text(),size:a.find("Size:first").text(),type:"file"}}),c.dirs=$.map(d.find("CommonPrefixes"),function(a){return a=$(a),{name:a.find("Prefix:first").text(),lastModified:"",size:"0",type:"directory"}}),e=d.find("NextMarker"),e=0!==e.length?e.text():"",""!==e&&(b.marker.index[b.page+1]=e),b.generateTable({list:c,prefix:a.prefix}),b.generateBreadcrumb({prefix:a.prefix}),b.updatePaginator(),b.hideContainer(b.$loaderContainer),b.showContainer(b.$container)},a.Bucketlist.prototype.parseItemSize=function(a){switch(a.bytes){case void 0:case null:case"":case"0":case 0:return"--"}var b,c;return b=["B","KB","MB","GB","TB"],c=parseInt(Math.floor(Math.log(a.bytes)/Math.log(1024)),10),Math.round(a.bytes/Math.pow(1024,c),2)+" "+b[c]},a.Bucketlist.prototype.generateTable=function(a){var b,c,d;b=this,c=[],d=$(["<tbody>","<tr>",'<td class="type text-center">','<span class="label">','<span class="glyphicon"></span>',"</span>","</td>",'<td class="name">','<a class="bucketlist-name-link"></a>',"</td>",'<td class="last-modified"></td>','<td class="size"></td>',"</tr>","</tbody>"].join(""));for(var e in a.list){var f,g,h;for(f=a.list[e],g=0,h=f.length;h>g;g++){var i,j,k,l,m,n;if(i=f[g].type,j="undefined"!=typeof f[g].name?f[g].name:"--","--"!==j&&(j=j.replace(new RegExp("^"+a.prefix),"","i").trim()),""!==j){switch(d.find("tr:first").attr("class",f[g].type).find("TD.type").attr("data-value",f[g].type).find("SPAN.label").addClass(b.nameLabel[f[g].type]).find("SPAN.glyphicon").addClass(b.nameIcon[f[g].type]),k={parsed:new Date("string"==typeof f[g].lastModified&&""!==f[g].lastModified?f[g].lastModified:0)},k.raw=k.parsed.getTime()/1e3,k.parsed=0===k.parsed.getTime()?"--":k.parsed,l={raw:"string"==typeof f[g].size&&""!==f[g].size?f[g].size:0},l.parsed=b.parseItemSize({bytes:l.raw}),m=j,i){case"directory":m="#!/"+encodeURIComponent(a.prefix+m);break;default:m=b.url+"/"+a.prefix+m}n={name:{href:m,download:"directory"===i?null:j}},d.find("TD.size:first").attr("data-value",l.raw).text(l.parsed),d.find("TD.last-modified:first").attr("data-value",k.raw).text(k.parsed),d.find("TD.name:first A:first").text(j).attr(n.name),c.push(d.html())}}}b.assignTableSelector(),b.$table.attr("data-sortable","").find("tbody:first").empty().html(c.join("")),Sortable.init()},a.Bucketlist.prototype.updatePaginator=function(){var a,b,c;a=this,b=a.$pagerContainer.find("LI.previous:first"),c=a.$pagerContainer.find("LI.next:first"),a.hideContainer(a.$pagerContainer),b.addClass("disabled"),c.addClass("disabled"),a.page>0&&b.removeClass("disabled"),a.page<a.marker.index.length-1&&c.removeClass("disabled"),b.hasClass("disabled")&&c.hasClass("disabled")||a.showContainer(a.$pagerContainer)},a.Bucketlist.prototype.navigatePaginator=function(a){var b,c;if(b=this,"string"==typeof a.action){switch(a.action){case"previous":b.page--;break;case"next":b.page++}c=b.marker.index[b.page],"string"==typeof c&&(b.marker.current=c,b.navigate())}},a.Bucketlist.prototype.generateBreadcrumb=function(a){var b,c,d,e,f,g,h;if(b=this,c=[],"string"==typeof a.prefix&&(c=a.prefix.split("/")),d=$('<ol><li><a class="bucketlist-nav" href="#!/">Home</a></li></ol>'),e=[d.html()],f="#!/",g=c.length,g>1)for(h=0,g-=1;g>h;h++){var i=c[h].trim();f=f+i+"/",d.find("LI:first > A:first").text(i).attr("href",f),e.push(d.html())}b.$breadcrumb.empty().html(e.join(""))}}(window);